
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Leandro Varela | Portfolio{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Google Font estilo medieval -->
    <link href="https://fonts.googleapis.com/css2?family=UnifrakturCook:wght@700&display=swap" rel="stylesheet">
    <!-- "Cinzel" (Google Fonts) -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&display=swap" rel="stylesheet">
    
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&display=swap" rel="stylesheet">


    

    <style>
        body {
        background: linear-gradient(to bottom, #1c1c1c, #000000);
        color: #f0e6d2;
        font-family: 'Segoe UI', sans-serif;
        padding-top: 60px; 
        }
        body {
            background-image: url("{{ url_for('static', filename='img/fondo_aoe4.png') }}");
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-repeat: no-repeat;
            color: #f5f5dc;
        }
        /* Overlay opcional para oscurecer */
        .overlay {
            background-color: rgba(0, 0, 0, 0.4);
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: -1;
        }
        
        .navbar {
        background-color: #111;
        border-bottom: 2px solid gold;
        height: 70px;
        }
        .navbar-brand, .nav-link {
        font-family: 'UnifrakturCook', cursive;
        color: gold !important;
        font-size: 1.2rem;
        }
        .nav-link:hover {
        text-shadow: 0 0 5px gold;
        }
        footer {
        border-top: 1px solid gold;
        color: #aaa;
        }
        .navbar-nav .nav-link {
        color: gold !important;
        }

        .navbar-nav .nav-link:hover {
        text-shadow: 0 0 4px gold;
        }
        /* Control audio */
        .audio-controls{
        position: fixed; bottom:20px; right:20px;
        display:flex; align-items:flex-end; gap:8px; z-index:9999;
        }
        .btn-audio{
        width:42px; height:42px; display:flex; align-items:center; justify-content:center;
        background:#111; color:gold; border:2px solid gold; border-radius:12px;
        box-shadow:0 0 10px rgba(255,215,0,.35); cursor:pointer; transition:box-shadow .2s;
        }
        .btn-audio:hover{ box-shadow:0 0 14px gold; }

        /* Panel angosto, se abre hacia la izquierda */
        .vol-panel{
        position:absolute; bottom:0; right:96px;
        width:60px; height:180px; padding:6px 8px;
        background:rgba(0,0,0,.9); border:2px solid gold; border-radius:12px;
        box-shadow:0 0 12px rgba(255,215,0,.35);
        display:flex; flex-direction:column; align-items:center; gap:6px;
        transform:translateX(120%); opacity:0; pointer-events:none;
        transition:transform .25s ease, opacity .25s ease;
        }
        .vol-panel.open{ transform:translateX(0); opacity:1; pointer-events:auto; }
        .vol-label{ 
            color:gold; 
            font-size:.85rem;
            text-align:center; }

        /* === Slider vertical por rotación (USAR SOLO ESTO) === */
        .vol-vertical{
        -webkit-appearance:none; appearance:none;
        width:120px;             /* largo real de la barra */
        height:8px;              /* grosor */
        background:#222; border:2px solid gold; border-radius:6px;
        transform:rotate(-90deg);
        transform-origin:center; /* centra dentro del panel */
        display:block; margin:8px auto;
        outline:none;
        }

        /* Track */
        .vol-vertical::-webkit-slider-runnable-track{
        height:8px; background:#222; border-radius:6px;
        }
        .vol-vertical::-moz-range-track{
        height:8px; background:#222; border-radius:6px;
        }

        /* Thumb */
        .vol-vertical::-webkit-slider-thumb{
        -webkit-appearance:none;
        width:16px; height:16px; background:gold;
        border:2px solid #000; border-radius:50%;
        box-shadow:0 0 6px rgba(255,215,0,.6); cursor:pointer;
        margin-top:-4px; /* centra sobre el track en WebKit */
        }
        .vol-vertical::-moz-range-thumb{
        width:16px; height:16px; background:gold;
        border:2px solid #000; border-radius:50%;
        box-shadow:0 0 6px rgba(255,215,0,.6); cursor:pointer;
        }

        .vol-wrap{
            display: flex;
            align-items: center;
            margin-top: 45px;            /* extra separación respecto al texto */
        }


        @media (max-width: 991.98px) {
            body {
                padding-top: 60px; /* menor espacio en pantallas más pequeñas */
            }
            .navbar-collapse {
                position: absolute;
                top: 70px; /* altura de tu navbar */
                left: 0;
                width: 100%;
                background-color: rgba(0, 0, 0, 0.85); /* fondo con opacidad */
                z-index: 999;
                padding: 1rem;
                border-bottom: 2px solid gold;
                border-top: 1px solid #333;
            }
            .navbar-toggler {
                margin-top: -1.3em;
            }
            .titulo-epico {
                font-size: 1.8rem;
            }
            .lead {
                font-size: 1rem;
            }
            .navbar-brand img {
                margin-top: -1em;
                max-height: 80px;
            }
        }

        @media (max-width: 576px) {
            .navbar-collapse {
                position: absolute;
                top: 70px; /* altura de tu navbar */
                left: 0;
                width: 100%;
                background-color: rgba(0, 0, 0, 0.85); /* fondo con opacidad */
                z-index: 999;
                padding: 1rem;
                border-bottom: 2px solid gold;
                border-top: 1px solid #333;
            }
            .navbar-toggler {
                margin-top: -1.3em;
            }
            .titulo-epico {
                font-size: 1.8rem;
            }
            .lead {
                font-size: 1rem;
            }
            .navbar-brand img {
                margin-top: -1em;
                max-height: 80px;
            }
        }
    </style>
</head>
<body >

    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        


        <div class="container-fluid">
            <div class="d-flex align-items-center" style="height: 100%;">
                <a class="navbar-brand" href="{{ url_for('main.home') }}">
                    <img src="{{ url_for('static', filename='img/escudoLogo.png') }}" class="d-inline-block align-text-top" alt="Logo" style="height: 90px; width: auto;">
                </a>
            </div>
            
            <!-- AUDIO -->
            <audio id="intro-audio" autoplay loop>
            <source src="{{ url_for('static', filename='audio/intro_home.mp3') }}" type="audio/mpeg">
            </audio>

            <!-- AUDIO CONTROLS -->
            <div id="audioCtrl" class="audio-controls">
            <div id="audioVolPanel" class="vol-panel">
                <span class="vol-label">Volume: <strong id="audioVolText">80</strong>%</span>
                <div class="vol-wrap">
                <input id="audioVolSlider" type="range" min="0" max="100" step="1"
                        value="30" class="vol-vertical">
                </div>
            </div>

            <!-- Botones a la derecha -->
            <button id="audioMuteBtn" class="btn-audio" title="Mute / Unmute">
                <i id="audioVolIcon" class="bi bi-volume-up-fill"></i>
            </button>
            <button id="audioPanelBtn" class="btn-audio" title="Volume">
                <i class="bi bi-caret-left-fill"></i>
            </button>
            </div>

                
            <!-- Botón hamburguesa -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" >
                <span class="navbar-toggler-icon"></span>
            </button>
            <!-- Menú -->
            
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('main.home') }}">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('main.projects')}}">Projects</a></li>
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('main.about')}}">About</a></li>
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('main.skills')}}">Skills</a></li>
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('main.experience')}}">Experience</a></li>
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('main.contact')}}">Contact</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- CONTENT -->
    <main class="container my-5">
        {% block content %}{% endblock %}
    </main>

    <footer class="text-center py-3">
        &copy; {{ year }} Leandro Varela | Crafted with courage <img src="{{ url_for('static', filename='img/img_two_swords.png')}}" alt="Img dos espadas" style="width: 40px; height: 40px;">
    </footer>
    <!-- Llamado al bootstrap5 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const audio = document.getElementById("intro-audio");
  const panel = document.getElementById("audioVolPanel");
  const slider = document.getElementById("audioVolSlider");
  const volText = document.getElementById("audioVolText");
  const muteBtn = document.getElementById("audioMuteBtn");
  const panelBtn = document.getElementById("audioPanelBtn");
  const icon = document.getElementById("audioVolIcon");

  const TKEY="intro_audio_time", PKEY="intro_audio_playing";
  const VKEY="intro_audio_volume";      // volumen actual (0..1)
  const MKEY="intro_audio_muted";       // 1/0
  const NZKEY="intro_audio_last_nonzero"; // último volumen > 0

  // ---- Init volumen/mute ----
  const storedVol   = parseFloat(localStorage.getItem(VKEY));
  const storedMuted = localStorage.getItem(MKEY) === "1";
  const lastNZVol   = parseFloat(localStorage.getItem(NZKEY));

  let initialVol = !isNaN(storedVol) ? storedVol : 0.2;
  // si está en 0 pero no queremos “quedarnos pegados”, dejamos 0,
  // pero guardamos un fallback razonable para desmuteo
  if (isNaN(lastNZVol)) localStorage.setItem(NZKEY, (initialVol > 0 ? initialVol : 0.8).toString());

  audio.volume = Math.max(0, Math.min(1, initialVol));
  audio.muted  = storedMuted;
  slider.value = Math.round(audio.volume * 100);
  volText.textContent = slider.value;

  // ---- Reanudar posición/estado ----
  const savedTime = parseFloat(localStorage.getItem(TKEY) || "0");
  const wasPlaying = localStorage.getItem(PKEY) === "1";
  audio.addEventListener("loadedmetadata", () => {
    if (!isNaN(savedTime) && savedTime < audio.duration) audio.currentTime = savedTime;
    if (wasPlaying) audio.play().catch(()=>{});
    updateIcon();
  });

  // Autoplay con fallback a 1er clic
  audio.play().catch(() => {
    document.body.addEventListener("click", () => audio.play(), {once:true});
  });

  // ---- Persistencia ----
  audio.addEventListener("timeupdate", () => localStorage.setItem(TKEY, audio.currentTime.toString()));
  const savePlayState = () => localStorage.setItem(PKEY, audio.paused ? "0" : "1");
  audio.addEventListener("play", savePlayState);
  audio.addEventListener("pause", savePlayState);
  window.addEventListener("beforeunload", () => {
    localStorage.setItem(TKEY, audio.currentTime.toString());
    localStorage.setItem(VKEY, audio.volume.toString());
    localStorage.setItem(MKEY, audio.muted ? "1" : "0");
    savePlayState();
  });

  // ---- UI helpers ----
  function updateIcon(){
    icon.className = (audio.muted || audio.volume === 0)
      ? "bi bi-volume-mute-fill"
      : "bi bi-volume-up-fill";
  }

  // Mute / Unmute
  muteBtn.addEventListener("click", () => {
    if (audio.muted) {
      // vamos a desmutear: si el volumen es 0, restauramos el último > 0 (o 0.8)
      let restore = parseFloat(localStorage.getItem(NZKEY));
      if (isNaN(restore) || restore <= 0) restore = 0.8;
      if (audio.volume === 0) {
        audio.volume = restore;
        slider.value = Math.round(restore * 100);
        volText.textContent = slider.value;
        localStorage.setItem(VKEY, audio.volume.toString());
      }
      audio.muted = false;
      localStorage.setItem(MKEY, "0");
      audio.play().catch(()=>{});
    } else {
      // mutear (sin tocar el volumen salvo guardar el último > 0)
      if (audio.volume > 0) localStorage.setItem(NZKEY, audio.volume.toString());
      audio.muted = true;
      localStorage.setItem(MKEY, "1");
    }
    updateIcon();
  });

  // Abrir / cerrar panel
  panelBtn.addEventListener("click", () => panel.classList.toggle("open"));

  // --- Slider de volumen (robusto) ---
  function applyVolumeFromSlider() {
    const raw = Number(slider.value);        // 0..100
    const vol = Math.max(0, Math.min(1, raw / 100)); // 0..1

    // si estaba muteado y el volumen > 0, desmutear
    if (audio.muted && vol > 0) {
      audio.muted = false;
      localStorage.setItem("intro_audio_muted", "0");
    }

    // aplicar volumen
    audio.volume = vol;

    // actualizar UI + persistencia
    volText.textContent = String(Math.round(vol * 100));
    localStorage.setItem("intro_audio_volume", String(vol));
    if (vol > 0) localStorage.setItem("intro_audio_last_nonzero", String(vol));

    // si el usuario tocó el control, ya hay interacción: asegurar reproducción
    if (audio.paused && vol > 0) {
      audio.play().catch(() => {});
    }

    // refrescar icono
    icon.className = (audio.muted || audio.volume === 0)
      ? "bi bi-volume-mute-fill"
      : "bi bi-volume-up-fill";
  }

  // Escuchar ambos eventos por compatibilidad
  slider.addEventListener("input", applyVolumeFromSlider);
  slider.addEventListener("change", applyVolumeFromSlider);
});
</script>



</body>
</html>